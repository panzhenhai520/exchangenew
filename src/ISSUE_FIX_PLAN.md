# 问题修复计划

## 问题总结

### 1. 国家列表语言不一致
**问题**: 当前页面语言设置为英文，但国家下拉列表显示中文
**原因**: API支持多语言，但可能前端获取的语言设置不正确

### 2. AMLO预约表单没有弹出
**问题**: 大额交易（89,200,000 THB）直接完成，没有触发AMLO预约表单
**原因**: 前端API格式已修复，但可能还有其他问题

### 3. 收据乱码问题
**问题**: 收据上显示小方框乱码
**原因**: PDF生成器使用 `'Helvetica'` 字体，不支持中文字符

## 修复方案

### 1. 修复收据字体问题（优先级最高）

**文件**: `src/services/thermal_exchange_pdf_generator.py`

**问题**: 第164行使用 `font_name = 'Helvetica'`，不支持中文

**修复方案**:
```python
# 修复前
font_name = 'Helvetica'  # 使用标准字体

# 修复后
font_name = PDFBase.get_safe_font_name()  # 使用支持中文的字体
```

需要检查 `PDFBase.get_safe_font_name()` 方法是否正确实现了中文字体支持。

### 2. 检查国家列表语言问题

**检查点**:
1. 前端是否正确获取当前语言设置
2. API是否正确返回对应语言的国家名称
3. 浏览器控制台的国家API调用日志

### 3. 检查AMLO触发问题

**检查点**:
1. 确认网点是否仍在日结锁定状态
2. 检查浏览器控制台的AMLO触发检查日志
3. 验证API响应格式

## 立即修复收据字体问题

这是最严重的问题，需要立即修复。
